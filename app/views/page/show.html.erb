<h1 class="clearfix"><%= @page.tagline %></h1>

<div class="push-it" id="push-it">
  <a href="#" class="play no-underline" ><img src="/images/<%= @page.button_url %>.png" alt="Button" class ="push-button" /></a>
</div>

<h1 class="count-pushes"><%= @page.pushes %></h1>

<div class="page-social clearfix">
	<div class="facebook-social">
	  <div id="fb-root"></div>	  
	  <div class="fb-like" data-href="http://pushitrealgood.com/page/<%= @page.title_url %>" data-send="false" data-layout="button_count" data-width="90" data-show-faces="true" data-font="arial"></div>
	</div>
	<div class="twitter-social">
	  <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://pushitrealgood.com/page/<%= @page.title_url %>" data-text="I just saw this on pushitrealgood.com!" data-count="horizontal">Tweet</a>
	</div>
	<div class="google-social">
	  <div class="g-plusone" data-size="medium" data-href="http://pushitrealgood.com/page/<%= @page.title_url %>"></div>
	</div>
	<div class="clearfix"></div>
</div>

<%= render "info" %>

<script>(function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) {return;}js = d.createElement(s); js.id = id;js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";fjs.parentNode.insertBefore(js, fjs);}(document, 'script','facebook-jssdk'));</script>
<script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
<script type="text/javascript">(function(){var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;	      po.src = 'https://apis.google.com/js/plusone.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);})();</script>

<script type="text/javascript">
var count = <%= @page.pushes %>;
function prepNonFlash() {
  var clip = document.createElement('audio');
  clip.src = "<%= @page.sound_url %>?client_id=72325d0b84c6a7f4bbef4dd86c0a5309";
  clip.load();
  clip.autobuffer = true;
  clip.preload = 'auto';
  $('.push-it').append(clip);
  $('.play').click( function(e) {
	e.preventDefault();
	clip.play();
	tally();
  });
  $('.play').mousedown( function(e) {
	e.preventDefault();
	$(this).find('img').css("margin-left","-250px");
  });
  $('.play').mouseup( function(e) {
	e.preventDefault();
	$(this).find('img').css("margin-left","0");
  });
}

function prepFlash () {
  var swfVersionStr = "10.0.0";
  var xiSwfUrlStr = "playerProductInstall.swf";
  var flashvars = {};
  flashvars.streamURL = "<%= @page.sound_url %>?client_id=72325d0b84c6a7f4bbef4dd86c0a5309";
  flashvars.imageURL = "/images/<%= @page.button_url %>.png";
  flashvars.pageID = "<%= @page.title_url %>"
  var params = {};
  params.quality = "best";
  params.wmode = "transparent";
  var attributes = {};
  swfobject.embedSWF("/swf/soundPlayer.swf", "push-it","250", "250", swfVersionStr, xiSwfUrlStr, flashvars, params, attributes);
  document.getElementById("push-it").focus();
}

function tally() {
	count++;
	$('.count-pushes').empty().append(count);
	check_count_for_one(count);
}
function check_count_for_one(count) {
	if( count == 1 ) {
	  $('.count-pushes').css( 'background-position', '-162px 0' );
	} else {
	  $('.count-pushes').css( 'background-position', '0 0' );
	}
}

function toggleInfo() {
	if( $('.more-info-button').hasClass("more-button-active") ) {
	  $('.creation-status-mask').animate( { height: "0px" }, 250, "linear", function() {
		$('.more-info-button').removeClass("more-button-active");
		$('.more-info-button').animate( { paddingBottom: "0" }, 100, "linear" );
 	  });
	  
	} else {
	  $('.more-info-button').animate( { paddingBottom: "10px" }, 100, "linear", function() {
		$('.more-info-button').addClass('more-button-active');
		$('.creation-status-mask').animate( { height: "43px" }, 250, "linear" );
	  });
	}
}

$('.more-info-button').click ( toggleInfo )

if( $("body").hasClass( "iphone" ) || $("body").hasClass("android"))
{
	prepNonFlash();
} else {
	prepFlash();
}

check_count_for_one( $('.count-pushes').text() );

</script>

