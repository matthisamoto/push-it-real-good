function check_url(){document.getElementById("create-new-button").disabled=true;if($("#page_title_url").val()){$.post("/test_url",{title_url:$("#page_title_url").val()},function(a){if(a.result=="fail"){if($("#page_title_url").parent().find(".LV_validation_message"))$("#page_title_url").parent().find(".LV_validation_message").remove();var b=clonable_div.clone().addClass("LV_validation_message").addClass("LV_invalid").text("This URL Is Unavailable");$("#page_title_url").addClass("LV_invalid_field").after(b)}else{if($("#page_title_url").parent().find(".LV_validation_message"))$("#page_title_url").parent().find(".LV_validation_message").remove();if($("#page_title_url").hasClass("LV_invalid_field"))$("#page_title_url").removeClass("LV_invalid_field");document.getElementById("create-new-button").disabled=false}},"json")}else{if($("#page_title_url").parent().find(".LV_validation_message"))$("#page_title_url").parent().find(".LV_validation_message").remove();var a=clonable_div.clone().addClass("LV_validation_message").addClass("LV_invalid").text("Cannot Be Empty");$("#page_title_url").addClass("LV_invalid_field").after(a)}}function toggleSections(){if($(".search-tracks").height()>0){$(".search-tracks").animate({height:"0"},500);$(".choose-button").animate({height:button_height},500,function(){document.getElementById("page_title_url").focus()});$(".button-header").css("background-image","url(/images/orange_tile.png)");$(".sound-header").css("background-image","url(/images/gray_tile.png)")}else{$(".search-tracks").animate({height:search_height},500);$(".choose-button").animate({height:"0"},500);$(".button-header").css("background-image","url(/images/gray_tile.png)");$(".sound-header").css("background-image","url(/images/orange_tile.png)")}}function preview_image(){$(".image-preview span.button-preview").empty().append('<image src="/images/'+$("#button_style_name option:selected").val().toLowerCase()+"_"+$("input[name=button_color]:checked").attr("value").toLowerCase()+'.png" height= "150" width="300" />');$(".image-preview span.button-preview img").mousedown(function(a){$(".image-preview img").css("margin-left","-150px")});$(".image-preview span.button-preview img").mouseup(function(a){$(".image-preview img").css("margin-left","0")});$(".button-url").empty().append('<input type="hidden" name="page[button_url]" class="url" value="'+$("#button_style_name option:selected").val().toLowerCase()+"_"+$("input[name=button_color]:checked").attr("value").toLowerCase()+'" />')}function retrieve_colors(){$.post("/retrieve_colors",{style:$("select#button_style_name option:selected").attr("value")},function(a){$(".choose-color").empty().append(a);preview_image();$("input[type=radio]").change(function(){preview_image()})})}function initSearchFunctionality(a){$(".play").click(function(a){a.preventDefault();togglePlayButton($(this),$(this).parent(),$(this).parent().attr("id"))});$(".select-track").click(function(a){a.preventDefault();killFlash();$("#page_sound_url").val("http://api.soundcloud.com/tracks/"+$(this).parent().parent().parent().attr("id")+"/stream");$("#page_track_name").val($(this).parent().parent().parent().find(".track-header .track-title a").text());$("#page_track_url").val($(this).parent().parent().parent().find(".track-header .track-title a").attr("href"));$("#page_track_author").val($(this).parent().parent().find(".track_author").text());$("#page_track_author_url").val($(this).parent().parent().find(".track_author").attr("href"));$(".track-name").empty().css("background-color","#888").css("background-color","rgba(0, 132, 0, 0.60)").css("padding","5px 0").css("cursor","pointer").append('<span class="added">Added track:</span> '+$(this).parent().parent().parent().find("span.track-title").text()).click(function(){$(".track-name").empty().css("background-color","transparent").css("padding","0");$(".id-container").empty()});toggleSections()});if(a=="initial"){if($(".close-results").length==0)$(".search-button").after('<a href="#" class="close-results button">Clear Results</a>');$(".close-results").click(function(a){a.preventDefault();$(".search-results").empty();$(".search-results").append('\t<div class="upload-coming-soon"></div>');$(this).remove()});search_scroll=$(".scroll-pane").jScrollPane({verticalDragMaxHeight:25,verticalDragMinHeight:25}).data("jsp");$(".scroll-pane").bind("jsp-scroll-y",function(a,b,c,d){if(d){moreResults();$(this).unbind("jsp-scroll-y")}})}else{search_scroll.reinitialise();$(".scroll-pane").bind("jsp-scroll-y",function(a,b,c,d){if(d){moreResults();$(this).unbind("jsp-scroll-y")}})}}function moreResults(){results_count++;var a=$("input#search").val();$.post("/search",{q:a,limit:10,offset:10*results_count,client_id:"72325d0b84c6a7f4bbef4dd86c0a5309",filter:"streamable"},function(a){search_scroll.getContentPane().append(a);initSearchFunctionality("subsequent")},"html")}function search_soundcloud(){results_count=0;$(".close-results").remove();if($(".search-tracks .division-inner .LV_validation_message"))$(".search-tracks .division-inner .LV_validation_message").remove();var a=$("input#search").val();$.post("/search",{q:a,limit:10,offset:10*results_count,client_id:"72325d0b84c6a7f4bbef4dd86c0a5309",filter:"streamable"},function(a){var b="";b+='<div class="search scroll-pane">'+"\n";b+=a;b+="</div>"+"\n";$(".search-results").empty().scrollTop(0).append(b);initSearchFunctionality("initial")},"html")}function start_playing(a,b){if($("body").hasClass("iphone")){prepNonFlash(a,b)}else{prepFlash(a)}}function resume_playing(){if($("body").hasClass("iphone")){var a=document.getElementById("audio");a.play()}else{};}function stop_playing(){if($("body").hasClass("iphone")){var a=document.getElementById("audio");a.pause()}else{killFlash()}}function togglePlayButton(a,b){var c=b.parent().attr("id");if(a.hasClass("active")){if(a.hasClass("playing")){stop_playing();a.find(".pause-img").addClass("hidden");a.find(".play-img").removeClass("hidden");a.removeClass("playing")}else{start_playing(c,b);a.find(".pause-img").removeClass("hidden");a.find(".play-img").addClass("hidden");a.addClass("playing")}}else{$(".play").removeClass("active");$(".pause-img").addClass("hidden");$(".play-img").removeClass("hidden");start_playing(c,b);a.addClass("active");a.addClass("playing");a.find(".pause-img").removeClass("hidden");a.find(".play-img").addClass("hidden")}}function killFlash(){var a=$("#"+current_preview_string);var b=a.parent();a.remove();b.prepend(clonable_div.clone().attr("id",current_preview_string))}function prepFlash(a){if($(current_preview_string))killFlash();var b="10.0.0";var c="playerProductInstall.swf";var d={};d.streamURL="http://api.soundcloud.com/tracks/"+a+"/stream?client_id=72325d0b84c6a7f4bbef4dd86c0a5309";var e={};e.quality="best";e.wmode="transparent";var f={};current_preview_string="flashcontent_"+a;swfobject.embedSWF("/swf/preview.swf",current_preview_string,"35","35",b,c,d,e,f)}function prepNonFlash(a,b){$("audio").each(function(a){$(this).empty()});var c=document.createElement("audio");c.src="http://api.soundcloud.com/tracks/"+a+"/stream?client_id=72325d0b84c6a7f4bbef4dd86c0a5309";c.load();c.id="audio";c.autobuffer=true;c.preload="auto";b.append(c);c.play()}function create_audio(a,b){$("audio").each(function(a){$(this).remove()});var c=document.createElement("audio");c.src="http://api.soundcloud.com/tracks/"+b+"/stream?client_id=72325d0b84c6a7f4bbef4dd86c0a5309";c.load();c.id="audio";c.autobuffer=true;c.preload="auto";a.append(c);c.play()}function add_container(){var a=container.clone().addClass("search-container");$(".search-results").prepend(a)}function killpreloader(){$("#"+current_preview_string).css("width","0")}var current_preview_string;var count=0;var current_page=1;var search_scroll;var results_count=0;var clonable_div=$("<div/>");var container=$("<div>");var csrf_token=$("meta[name=csrf-token]").attr("content");$("body").bind("ajaxSend",function(a,b,c){if(c.type=="POST"){b.setRequestHeader("X-CSRF-Token",csrf_token)}});$("#page_tagline").keyup(function(){$(".title-preview").empty().text($(this).val());if($(".title-preview").text()=="")$(".title-preview").append("My Title")});$("select#button_style_name").selectBox();retrieve_colors();$("select#button_style_name").change(retrieve_colors);$(".search-button").click(function(a){a.preventDefault();search_soundcloud()});$("#search").keypress(function(a){if(a.which==13){a.preventDefault();search_soundcloud()}});$("#search").click(function(a){if($(this).val()=="Search SoundCloud for Tracks"){$(this).val("")}});$(".next").each(function(){$(this).click(function(a){a.preventDefault();moveScreen("forward");$(".search-results").empty();$(".close-results").remove()})});$(".prev").each(function(){$(this).click(function(a){a.preventDefault();moveScreen("backward")})});var button_height=630;var search_height=630;$(".choose-button").css({height:"0"});$(".button-header").click(function(a){toggleSections()});$(".sound-header").css("background-image","url(/images/orange_tile.png)").click(function(a){toggleSections()});var titleValid=new LiveValidation("page_title_url",{validMessage:"âœ”",onlyOnSubmit:true});titleValid.add(Validate.Format,{pattern:/^[A-Za-z0-9]*[A-Za-z0-9][A-Za-z0-9]*$/,failureMessage:"Letters and Numbers Only"});titleValid.add(Validate.Presence,{failureMessage:"Letters and Numbers Only."});$("#page_title_url").keyup(function(a){check_url()});$("#page_title_url").change(function(a){check_url()});$("#page_title_url").focus(function(a){check_url()});$("#page_title_url").blur(function(a){check_url()});$("input[type=submit]").click(function(a){if($(".id-container input.url").val()){if($("#page_title_url").hasClass("LV_invalid_field"))return false}else{a.preventDefault();var b=clonable_div.clone().addClass("LV_validation_message").addClass("LV_invalid").text("You Must Select A Track To Continue");$(".search-tracks .division-inner").prepend(b);toggleSections()}})